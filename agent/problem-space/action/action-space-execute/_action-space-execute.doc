############## problem-space.action-space execute ###############

### State Representation ###
task-operator: The operator representing this task
task-concept-network: The root LTI for the smem knowledge about this task

action-stack: The top-state stack representing the current task decomposition
current-action: The segment on the action-stack for this substate
parent-action: The parent task's action segment
child-action: The child task's action segment




### Problem Space ###
(<ps> ^name action
      ^action-space execute
	  ^world.copy-type shallow)

### Order of things ###

1. The first time an execute-task substate is reached, remove the ^start-of-execution flag
   OP: remove-start-of-execution

2. Retrieve the TCN 


### Operators ###
remove-start-of-execution-flag
  When an action-stack segment is first created, it has ^start-of-execution true
  First time an execute-task substate is reached, this flag is removed

smem-query [retrieve-tcn]
  Will retrieve the smem info for the action being executed

init-current-subgoal
  Will initialize ^task-operator.current-subgoal if not present

<child-action>
  If there is a child-action segment with an execution-operator, propose it

pop-action-segment
  If the child-action segment is satisfied, pop it

advance-current-subgoal
  If the current-subgoal is satisfied and there is another subgoal, 
    change the current-subgoal on the task-operator

copy-task-operator
   If we are in an execute-task substate without a segment, 
   propose copy-task-operator to copy the task-operator and create a new segment

push-action-segment
   If there is a ^new-action-segment on the state, 
   Push a new segment onto the stack

add-subtask-to-tcn
   If a child action came from instruction, 
   (has ^action-source instruction)
   Creates a generalized smem version and adds it to the TCN

   Waits until there is a ^created-subtask <h> 
     then removes it and adds ^learn-subtask-proposal <h>

complete-action
  If the goal is satisfied, or a failure detected, 
    add a ^status to the current-action representation

pop-action-segment
  If the child-action segment has a status, 
     pop the segment 
  

wait
  If the flag ^propose-wait true is on the state, this will propose a wait operator


  preferences.soar


### Task Learning ###

Task Structure - What arguments are needed
  A new task command given by the instructor, 
  Inside generate-task-operator, adds/modifies TCN

Task Goal - What the purpose of the task are
  

### Knowledge Needed ###
Goal Elaboration
Subaction Proposals
Selection Knowledge


###############################################################
# Previous

These rules are specific to when the agent is trying to execute
actions in the real world

### elaborations
   current-action : action segment, copied from superstate
   parent-action  : the previous action segment
   child-action   : the next action segment
   action-matched <bool> : if the match-task-operator has a match

### validate-child-action
    If a child-action is there, and it has not been validated, 
    This will try to match it against proposed action operators
    If it does match, it will mark the child-action as validated

### apply-primitive-action
    When a primitive action is selected through preferences in a composite task,
    Create a new segment to push onto the action stack for that primitive action

### report-success
    This operator will mark the current-action with ^status success, 
    and clean up any output commands that were made
    For composites: proposed if desired.satisfied true
    For primatives: proposed if the action is finished, 
      (See proposals in execute-task/execute-primitive-action)

### report-failure
   This operator will mark the current-action with ^status failure,
   Remove any commands on the output-link,
   And will copy any failure info onto the current action (failure-type and failure-info)
   For primatives: proposed individually if the action fails
      (See proposals in execute-task/execute-primitive-action)

### pop-finished-action
   If there is a status on the current-action, this will pop it from the stack


### add-subtask-to-tcn
    If the child-action doesn't match a proposed action, 
    and it is labeled with ^learn-proposal true, 
    then create a new smem rep of that subtask to store (<s> ^store-subtask <sub>)

### store-subtask
    When there is a ^store-subtask <sub> wme on the state, 
    This will store it in smem and add it to the task-concept-network.procedural info
