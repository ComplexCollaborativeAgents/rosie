### For the internal environment, simulate the use command on the top-state world ###

sp {op_use1*propose*simulate-use-command
   (state <s> ^name op_use1
              ^problem-space.execution-type external
              ^agent-params.domain internal
              ^current-task-segment <seg>)
   (<seg> ^use-command <cmd>)
   (<cmd> -^status success)
-->
   (<s> ^operator <o> +)
   (<o> ^name simulate-use-command
        ^item-type command-operator
        ^command <cmd>)
}

sp {op_use1*apply*simulate-use-command*mark*command*success
   (state <s> ^name op_use1
              ^operator <o>)
   (<o> ^name simulate-use-command
        ^command <cmd>)
-->
   (<cmd> ^status success)
}

### simulate-perception = false, change on the object directly ###

# Use kettle - fill target with water
sp {op_use1*apply*simulate-use-command*kettle*fillable
   (state <s> ^name op_use1
              ^operator <o>
             -^agent-params.simulate-perception true)
   (<o> ^name simulate-use-command
        ^command <cmd>)
   (<cmd> ^object.predicates.category kettle1
          ^target.predicates <preds>)
   (<preds> ^affordance1 fillable1
            ^is-filled1 empty1)
-->
   (<preds> ^is-filled1 empty1 -
            ^is-filled1 filled1
            ^liquid1 water1)
}

# Use fillable with sink - empty target
sp {op_use1*apply*simulate-use-command*empty*fillable*sink
   (state <s> ^name op_use1
              ^operator <o>
             -^agent-params.simulate-perception true)
   (<o> ^name simulate-use-command
        ^command <cmd>)
   (<cmd> ^object.predicates <preds>
          ^target.predicates.category sink1)
   (<preds> ^affordance1 fillable1
            ^is-filled1 filled1
            ^liquid1 <liq>)
-->
   (<preds> ^is-filled1 filled1 -
            ^is-filled1 empty1
            ^liquid1 <liq> -)
}

### simulate-perception = true, change on the perception-monitor ###


# Use kettle - fill target with water
sp {op_use1*apply*simulate-use-command*kettle*fillable
   (state <s> ^name op_use1
              ^operator <o>
             -^agent-params.simulate-perception true)
   (<o> ^name simulate-use-command
        ^command <cmd>)
   (<cmd> ^object.predicates.category kettle1
          ^target.predicates <preds>)
   (<preds> ^affordance1 fillable1
            ^is-filled1 empty1)
-->
   (<preds> ^is-filled1 empty1 -
            ^is-filled1 filled1
            ^liquid1 water1)
}

# Use fillable with sink - empty target
sp {op_use1*apply*simulate-use-command*empty*fillable*sink
   (state <s> ^name op_use1
              ^operator <o>
             -^agent-params.simulate-perception true)
   (<o> ^name simulate-use-command
        ^command <cmd>)
   (<cmd> ^object.predicates <preds>
          ^target.predicates.category sink1)
   (<preds> ^affordance1 fillable1
            ^is-filled1 filled1
            ^liquid1 <liq>)
-->
   (<preds> ^is-filled1 filled1 -
            ^is-filled1 empty1
            ^liquid1 <liq> -)
}

