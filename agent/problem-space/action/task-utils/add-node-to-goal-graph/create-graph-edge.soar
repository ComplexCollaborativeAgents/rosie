
# If told to ^insert-after-node <node-h>, 
#   then create an edge from the previuos node to the created one
sp {add-node-to-goal-graph*elaborate*create-graph-edge*from*previous-node
   (state <s> ^name add-node-to-goal-graph
              ^created-node <node>
              ^insert-after-node <prev-h>
              ^previous-node <prev>
             -^goal-conditions)
-->
   (<s> ^create-graph-edge <edge>)
   (<edge> ^head <prev> 
           ^tail <node>)
}

sp {add-node-to-goal-graph*elaborate*create-graph-edge*from*previous-node*with*conditions
   (state <s> ^name add-node-to-goal-graph
              ^created-node <node>
              ^insert-after-node <prev-h>
              ^previous-node <prev>
              ^goal-conditions <conds>)
-->
   (<s> ^create-graph-edge <edge>)
   (<edge> ^head <prev> 
           ^tail <node>
           ^conditions <conds>)
}

# If told to ^insert-before-node <node-h>
#   then create an edge from the created node to the following one
sp {add-node-to-goal-graph*elaborate*create-graph-edge*to*following-node
   (state <s> ^name add-node-to-goal-graph
              ^created-node <node>
              ^insert-before-node <next-h>
              ^following-node <next>)
-->
   (<s> ^create-graph-edge <edge>)
   (<edge> ^head <node> 
           ^tail <next>)
}

# If told that this was the final goal, 
#   then create an edge from the created node to the terminal node
sp {add-node-to-goal-graph*elaborate*create-graph-edge*final-goal
   (state <s> ^name add-node-to-goal-graph
              ^final-goal true
              ^created-node <node>
              ^created-terminal-node <term>)
-->
   (<s> ^create-graph-edge <edge>)
   (<edge> ^head <node> 
           ^tail <term>)
}

# If ^add-else-link true:
#  add a link from the created node to the intermediate node
#  add a link from the previous node to the intermediate node
sp {add-node-to-goal-graph*elaborate*create-graph-edge*add-else-link
   (state <s> ^name add-node-to-goal-graph
              ^add-else-link true
              ^previous-node <prev>
              ^created-node <node>
              ^created-intermediate-node <int>)
-->
   (<s> ^create-graph-edge <edge>)
   (<edge> ^head <node> 
           ^tail <int>)
   (<s> ^create-graph-edge <edge2>)
   (<edge2> ^head <prev> 
            ^tail <int>)
}

### PROPOSE: 1 operator for each ^create-graph-edge elaborated on the state
sp {add-node-to-goal-graph*propose*create-graph-edge
   (state <s> ^name add-node-to-goal-graph
              ^create-graph-edge <edge>)
   (<edge> ^head <head>
           ^tail <tail>
          -^edge)
-->
   (<s> ^operator <o> + =)
   (<o> ^name create-graph-edge
        ^source <edge>
        ^head <head>
        ^tail <tail>)
}

## APPLY: Create a next pointer from the head to the tail
sp {add-node-to-goal-graph*apply*create-graph-edge
   (state <s> ^name add-node-to-goal-graph
              ^operator <o>)
   (<o> ^name create-graph-edge
        ^source <src>
        ^head <head>
        ^tail <tail>)
   (<src> -^conditions)
-->
   (<head> ^next <next>)
   (<next> ^goal <tail>)

   (<src> ^edge <next>)
   (<s> ^store-edge <src>)
}

sp {add-node-to-goal-graph*apply*create-graph-edge*with*conditions
   (state <s> ^name add-node-to-goal-graph
              ^operator <o>)
   (<o> ^name create-graph-edge
        ^source <src>
        ^head <head>
        ^tail <tail>)
   (<src> ^conditions <conds>)
-->
   (<head> ^next <next>)
   (<next> ^conditions <conds> ^goal <tail>)

   (<src> ^edge <next>)
   (<s> ^store-edge <src>)
}

